name: ğŸ“Š ãƒ‡ã‚¤ãƒªãƒ¼ãƒ¬ãƒãƒ¼ãƒˆãƒãƒ–åŒæœŸ v2.3 (YUKIHIKO PRç‰ˆ - å®Œå…¨ãƒªãƒ¢ãƒ¼ãƒˆå®Ÿè¡Œ)
on:
  push:
    branches: [main, master]
  pull_request:
    types: [opened, synchronize, closed]

env:
  WEEK_START_DAY: 1
  AUTO_APPROVE: true
  AUTO_MERGE: true  
  CREATE_PR: true
  # ãƒªãƒ¢ãƒ¼ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®è¨­å®š
  SCRIPTS_BASE_URL: https://raw.githubusercontent.com/Sunwood-ai-labsII/daily-report-hub_dev/main/.github/scripts

jobs:
  sync-data:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ ç¾åœ¨ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ“… é€±æƒ…å ±ã‚’è¨ˆç®—
        run: curl -LsSf ${SCRIPTS_BASE_URL}/calculate-week-info.sh | sh -s -- ${{ env.WEEK_START_DAY }}

      - name: ğŸ” Gitæ´»å‹•ã‚’åˆ†æ
        run: curl -LsSf ${SCRIPTS_BASE_URL}/analyze-git-activity.sh | sh

      - name: ğŸ“ Markdownãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ
        run: curl -LsSf ${SCRIPTS_BASE_URL}/generate-markdown-reports.sh | sh

      - name: ğŸ“‚ ãƒ¬ãƒãƒ¼ãƒˆãƒãƒ–ã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
        env:
          GITHUB_TOKEN: ${{ secrets.GH_PAT }}
          REPORT_HUB_REPO: ${{ vars.REPORT_HUB_REPO || 'Sunwood-ai-labsII/daily-report-hub' }}
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"
          git clone https://x-access-token:${GITHUB_TOKEN}@github.com/${REPORT_HUB_REPO}.git daily-report-hub

      - name: ğŸ—ï¸ Docusaurusæ§‹é€ ã‚’ä½œæˆ
        run: curl -LsSf ${SCRIPTS_BASE_URL}/create-docusaurus-structure.sh | sh

      - name: ğŸš€ YUKIHIKOæ¨©é™ã§PRä½œæˆï¼†è‡ªå‹•æ‰¿èª
        env:
          GITHUB_TOKEN_ORIGINAL: ${{ secrets.GH_PAT }}      # æ‰¿èªç”¨
          YUKIHIKO_TOKEN: ${{ secrets.GH_PAT_YUKIHIKO }}     # PRä½œæˆç”¨
          GITHUB_TOKEN: ${{ secrets.GH_PAT }}              # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
          REPORT_HUB_REPO: ${{ vars.REPORT_HUB_REPO || 'Sunwood-ai-labsII/daily-report-hub' }}
        run: curl -LsSf ${SCRIPTS_BASE_URL}/sync-to-hub-gh.sh | sh
